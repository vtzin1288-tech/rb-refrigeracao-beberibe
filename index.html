<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RB Refrigeração Beberibe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; margin:0; padding:0; }
header { background: #0b5ed7; color: white; padding: 20px; text-align:center; }
section { padding: 20px; }
.card { background: white; padding:20px; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.2); margin-bottom:20px; }
input, button { width:100%; padding:12px; margin-top:10px; font-size:16px; }
button { background:#0b5ed7; color:white; border:none; border-radius:5px; cursor:pointer; }
button:hover { opacity:0.9; }
table { width:100%; border-collapse: collapse; margin-top:10px; font-size:14px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#0b5ed7; color:white; }
td.entrada { background: #d4edda; }
td.saida { background: #f8d7da; }
td.almoco { background: #fff3cd; }
td.horaExtra { background: #ffeeba; }
</style>
</head>
<body>

<header>
<h1>RB Refrigeração Beberibe</h1>
<p>Sistema de Controle de Horários</p>
</header>

<!-- LOGIN -->
<section id="loginCard" class="card">
<h3>Login</h3>
<input type="text" id="userCode" placeholder="Digite seu código (ex: RB01 ou ADM01)">
<input type="text" id="userName" placeholder="Digite seu nome opcional">
<button onclick="login()">Entrar</button>
<p id="loginMsg" style="color:red;"></p>
</section>

<!-- ÁREA DO FUNCIONÁRIO -->
<section id="funcCard" class="card" style="display:none">
<h3>Bem-vindo <span id="funcName"></span></h3>
<button onclick="verRegistrosFuncionario()">Ver Todos os Seus Registros</button>
<table id="horariosTable">
<thead>
<tr>
<th>Entrada</th>
<th>Saída Almoço</th>
<th>Retorno Almoço</th>
<th>Saída Trabalho</th>
<th>Hora Extra</th>
</tr>
</thead>
<tbody>
<tr>
<td><input type="time" id="entrada"></td>
<td><input type="time" id="saidaAlmoco"></td>
<td><input type="time" id="retornoAlmoco"></td>
<td><input type="time" id="saidaTrabalho"></td>
<td><input type="time" id="horaExtra"></td>
</tr>
</tbody>
</table>
<button onclick="salvarRegistro()">Salvar Registro</button>
<h4>Seus registros:</h4>
<div id="registrosFuncionario"></div>
</section>

<!-- ÁREA DO PATRÃO -->
<section id="bossCard" class="card" style="display:none">
<h3>Área do Patrão</h3>
<button onclick="verTodosRegistros()">Ver Todos os Registros de Funcionários</button>
<button onclick="apagarTodosRegistros()">Apagar Todos os Registros de Todos</button>
<button onclick="resetNomes()">Resetar Nome Opcional</button>
<h4>Todos os Registros:</h4>
<div id="todosRegistros"></div>
</section>

<script>
// ==== CONFIGURAÇÃO ====
const codigosValidos = [];
for (let i=1; i<=100; i++) {
    codigosValidos.push("RB"+i.toString().padStart(2,'0'));
}
const codigoPatrao = "ADM01";

// ==== ARMAZENAMENTO ====
let registros = JSON.parse(localStorage.getItem("registros")) || {};
let nomesFixos = JSON.parse(localStorage.getItem("nomesFixos")) || {};

// ==== LOGIN ====
function login(){
    const code = document.getElementById("userCode").value.trim().toUpperCase();
    const name = document.getElementById("userName").value.trim();
    const loginMsg = document.getElementById("loginMsg");
    loginMsg.textContent = "";

    if(code === codigoPatrao){
        // Patrão
        showBoss();
    } else if(codigosValidos.includes(code)){
        // Funcionário
        // Verifica nome opcional fixo
        if(nomesFixos[code]){
            if(name !== nomesFixos[code]){
                loginMsg.textContent = "Erro: Nome incorreto. Deve ser o nome fixo definido anteriormente.";
                return;
            }
        } else {
            if(!name){
                loginMsg.textContent = "Você precisa definir um nome opcional.";
                return;
            }
            nomesFixos[code] = name;
            localStorage.setItem("nomesFixos", JSON.stringify(nomesFixos));
        }
        showFuncionario(code, name);
    } else {
        loginMsg.textContent = "Código inválido.";
    }
}

// ==== MOSTRAR FUNCIONÁRIO ====
let usuarioAtual = "";
function showFuncionario(code, name){
    usuarioAtual = code;
    document.getElementById("loginCard").style.display="none";
    document.getElementById("funcCard").style.display="block";
    document.getElementById("funcName").textContent = name;
    atualizarRegistrosFuncionario();
}

// ==== SALVAR REGISTRO ====
function salvarRegistro(){
    const entrada = document.getElementById("entrada").value;
    const saidaAlmoco = document.getElementById("saidaAlmoco").value;
    const retornoAlmoco = document.getElementById("retornoAlmoco").value;
    const saidaTrabalho = document.getElementById("saidaTrabalho").value;
    const horaExtra = document.getElementById("horaExtra").value;

    if(!registros[usuarioAtual]){
        registros[usuarioAtual] = [];
    }

    const registro = {
        data: new Date().toLocaleString(),
        entrada, saidaAlmoco, retornoAlmoco, saidaTrabalho, horaExtra,
        nome: nomesFixos[usuarioAtual]
    };
    registros[usuarioAtual].push(registro);
    localStorage.setItem("registros", JSON.stringify(registros));
    atualizarRegistrosFuncionario();
    alert("Registro salvo!");
}

// ==== ATUALIZAR REGISTROS FUNCIONÁRIO ====
function atualizarRegistrosFuncionario(){
    const div = document.getElementById("registrosFuncionario");
    div.innerHTML = "";
    if(!registros[usuarioAtual]) return;
    let html = `<table><tr>
    <th>Data</th><th>Entrada</th><th>Saída Almoço</th><th>Retorno Almoço</th><th>Saída Trabalho</th><th>Hora Extra</th></tr>`;
    registros[usuarioAtual].forEach(r=>{
        html+=`<tr>
        <td>${r.data}</td>
        <td>${r.entrada}</td>
        <td>${r.saidaAlmoco}</td>
        <td>${r.retornoAlmoco}</td>
        <td>${r.saidaTrabalho}</td>
        <td>${r.horaExtra}</td>
        </tr>`;
    });
    html+="</table>";
    div.innerHTML = html;
}

// ==== VER TODOS REGISTROS (PATRÃO) ====
function showBoss(){
    document.getElementById("loginCard").style.display="none";
    document.getElementById("bossCard").style.display="block";
}

function verTodosRegistros(){
    const div = document.getElementById("todosRegistros");
    div.innerHTML="";
    for(const code in registros){
        const nome = nomesFixos[code] || code;
        div.innerHTML += `<h4>${nome}</h4>`;
        let html = `<table><tr>
        <th>Data</th><th>Entrada</th><th>Saída Almoço</th><th>Retorno Almoço</th><th>Saída Trabalho</th><th>Hora Extra</th></tr>`;
        registros[code].forEach(r=>{
            html+=`<tr>
            <td>${r.data}</td>
            <td>${r.entrada}</td>
            <td>${r.saidaAlmoco}</td>
            <td>${r.retornoAlmoco}</td>
            <td>${r.saidaTrabalho}</td>
            <td>${r.horaExtra}</td>
            </tr>`;
        });
        html+="</table>";
        div.innerHTML += html;
    }
}

// ==== APAGAR TODOS REGISTROS (PATRÃO) ====
let confirmarApagar = false;
function apagarTodosRegistros(){
    if(!confirmarApagar){
        alert("Clique novamente para confirmar apagar TODOS os registros!");
        confirmarApagar = true;
        setTimeout(()=>{confirmarApagar=false},5000);
        return;
    }
    registros = {};
    localStorage.setItem("registros", JSON.stringify(registros));
    document.getElementById("todosRegistros").innerHTML="";
    alert("Todos os registros apagados!");
}

// ==== RESET DE NOMES OPCIONAIS (PATRÃO) ====
function resetNomes(){
    const code = prompt("Digite o código do funcionário para resetar o nome opcional:");
    if(!code) return;
    if(!nomesFixos[code]){
        alert("Código não possui nome definido.");
        return;
    }
    delete nomesFixos[code];
    localStorage.setItem("nomesFixos", JSON.stringify(nomesFixos));
    alert("Nome opcional resetado. Funcionário poderá definir novo nome ao logar.");
}

// ==== VER REGISTROS DO FUNCIONÁRIO ====
function verRegistrosFuncionario(){
    atualizarRegistrosFuncionario();
}
</script>

</body>
</html>
